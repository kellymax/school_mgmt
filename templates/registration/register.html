{% extends 'base_auth.html' %}

{% block title %}Create Account - School Management System{% endblock %}

{% block form_title %}
<div class="text-center mb-5">
  <h1 class="h3 font-weight-bold mb-2">Create Account</h1>
  <p class="text-muted">Fill in the form below to create your account</p>
</div>
{% endblock %}

{% block content %}
<form method="POST" class="needs-validation" novalidate>
  {% csrf_token %}
  
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <div class="d-flex align-items-center">
          <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% elif message.tags == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} me-2"></i>
          <div>{{ message }}</div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="row g-3">
    <!-- Personal Information -->
    <div class="col-12">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-user me-2"></i> Personal Information
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="first_name" name="first_name" 
               placeholder="First Name" value="{{ values.first_name|default:'' }}" required>
        <label for="first_name">First Name <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter your first name
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="last_name" name="last_name" 
               placeholder="Last Name" value="{{ values.last_name|default:'' }}" required>
        <label for="last_name">Last Name <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter your last name
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="email" class="form-control" id="email" name="email" 
               placeholder="Email" value="{{ values.email|default:'' }}" required>
        <label for="email">Email <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter a valid email address
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="tel" class="form-control" id="phone" name="phone" 
               placeholder="Phone" value="{{ values.phone|default:'' }}" required>
        <label for="phone">Phone <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter your phone number
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <select class="form-select" id="gender" name="gender" required>
          <option value="" disabled selected>Select Gender</option>
          {% for value, label in genders %}
            <option value="{{ value }}" {% if values.gender == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
        <label for="gender">Gender <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please select your gender
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" 
               value="{{ values.date_of_birth|default:'' }}" required>
        <label for="date_of_birth">Date of Birth <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter your date of birth
        </div>
      </div>
    </div>
    
    <div class="col-12">
      <div class="form-floating">
        <textarea class="form-control" id="address" name="address" 
                  placeholder="Address" style="height: 100px" required>{{ values.address|default:'' }}</textarea>
        <label for="address">Address <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please enter your address
        </div>
      </div>
    </div>
    
    <!-- Account Information -->
    <div class="col-12 mt-4">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-lock me-2"></i> Account Information
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="username" name="username" 
               placeholder="Username" value="{{ values.username|default:'' }}" required>
        <label for="username">Username <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please choose a username
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <select class="form-select" id="role" name="role" required>
          <option value="" disabled selected>Select Role</option>
          {% for value, label in role_choices %}
            <option value="{{ value }}" {% if values.role == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
        <label for="role">Account Type <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Please select your role
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="password" class="form-control" id="password1" name="password1" 
               placeholder="Password" required minlength="8">
        <label for="password1">Password <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Password must be at least 8 characters long
        </div>
        <div class="form-text">
          <small>At least 8 characters</small>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="password" class="form-control" id="password2" name="password2" 
               placeholder="Confirm Password" required>
        <label for="password2">Confirm Password <span class="text-danger">*</span></label>
        <div class="invalid-feedback">
          Passwords must match
        </div>
      </div>
    </div>
    
    <div class="col-12 mt-4">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
        <label class="form-check-label" for="terms">
          I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
        </label>
        <div class="invalid-feedback">
          You must agree to the terms and conditions
        </div>
      </div>
    </div>
    
    <div class="col-12 mt-4">
      <button class="btn btn-primary w-100 py-3" type="submit">
        <i class="fas fa-user-plus me-2"></i> Create Account
      </button>
    </div>
  </div>
</form>
{% endblock %}

{% block form_footer %}
<div class="text-center mt-4">
  <p class="mb-0">
    Already have an account? 
    <a href="{% url 'login' %}" class="text-primary fw-semibold">
      Sign In
    </a>
  </p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Form validation
  const forms = document.querySelectorAll('.needs-validation');
  
  // Loop over them and prevent submission
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      form.classList.add('was-validated');
    }, false);
  });
  
  // Password match validation
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  
  function validatePassword() {
    if (password1.value !== password2.value) {
      password2.setCustomValidity("Passwords don't match");
    } else {
      password2.setCustomValidity('');
    }
  }
  
  password1.addEventListener('change', validatePassword);
  password2.addEventListener('keyup', validatePassword);
  
  // Set maximum date for date of birth (18 years ago)
  const today = new Date();
  const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
  document.getElementById('date_of_birth').max = maxDate.toISOString().split('T')[0];
});
</script>
{% endblock %}
