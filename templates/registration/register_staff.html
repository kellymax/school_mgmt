{% extends 'base_auth.html' %}

{% block title %}Staff Registration - School Management System{% endblock %}

{% block form_title %}
<div class="text-center mb-5">
  <h1 class="h3 font-weight-bold mb-2">Staff Registration</h1>
  <p class="text-muted">Please fill in your details to create a staff account</p>
</div>
{% endblock %}

{% block content %}
<form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
  {% csrf_token %}
  
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <div class="d-flex align-items-center">
          <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% elif message.tags == 'danger' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} me-2"></i>
          <div>{{ message }}</div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="row g-3">
    <!-- Personal Information -->
    <div class="col-12">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-user-tie me-2"></i> Personal Information
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="first_name" name="first_name" 
               placeholder="First Name" value="{{ values.first_name|default:'' }}" required>
        <label for="first_name">First Name <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="last_name" name="last_name" 
               placeholder="Last Name" value="{{ values.last_name|default:'' }}" required>
        <label for="last_name">Last Name <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="staff_id" name="staff_id" 
               placeholder="Staff ID" value="{{ values.staff_id|default:'' }}" required>
        <label for="staff_id">Staff ID <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <select class="form-select" id="role" name="role" required>
          <option value="" disabled selected>Select Role</option>
          <option value="TEACHER" {% if values.role == 'TEACHER' %}selected{% endif %}>Teacher</option>
          <option value="ADMIN" {% if values.role == 'ADMIN' %}selected{% endif %}>Administrator</option>
          <option value="OTHER" {% if values.role == 'OTHER' %}selected{% endif %}>Other Staff</option>
        </select>
        <label for="role">Role <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" 
               value="{{ values.date_of_birth|default:'' }}" required>
        <label for="date_of_birth">Date of Birth <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <select class="form-select" id="gender" name="gender" required>
          <option value="" disabled selected>Select Gender</option>
          <option value="M" {% if values.gender == 'M' %}selected{% endif %}>Male</option>
          <option value="F" {% if values.gender == 'F' %}selected{% endif %}>Female</option>
          <option value="O" {% if values.gender == 'O' %}selected{% endif %}>Other</option>
        </select>
        <label for="gender">Gender <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-12">
      <div class="form-floating">
        <textarea class="form-control" id="address" name="address" 
                  placeholder="Address" style="height: 100px" required>{{ values.address|default:'' }}</textarea>
        <label for="address">Address <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <!-- Contact Information -->
    <div class="col-12 mt-4">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-address-card me-2"></i> Contact Information
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="email" class="form-control" id="email" name="email" 
               placeholder="Email" value="{{ values.email|default:'' }}" required>
        <label for="email">Email Address <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="tel" class="form-control" id="phone" name="phone" 
               placeholder="Phone" value="{{ values.phone|default:'' }}" required>
        <label for="phone">Phone Number <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <!-- Account Information -->
    <div class="col-12 mt-4">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-user-lock me-2"></i> Account Information
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="text" class="form-control" id="username" name="username" 
               placeholder="Username" value="{{ values.username|default:'' }}" required>
        <label for="username">Username <span class="text-danger">*</span></label>
        <div class="form-text">Choose a unique username</div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="password" class="form-control" id="password1" name="password1" 
               placeholder="Password" required>
        <label for="password1">Password <span class="text-danger">*</span></label>
        <div class="form-text">At least 8 characters with numbers & symbols</div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-floating">
        <input type="password" class="form-control" id="password2" name="password2" 
               placeholder="Confirm Password" required>
        <label for="password2">Confirm Password <span class="text-danger">*</span></label>
      </div>
    </div>
    
    <!-- Documents -->
    <div class="col-12 mt-4">
      <h6 class="fw-semibold mb-3">
        <i class="fas fa-file-upload me-2"></i> Documents
      </h6>
    </div>
    
    <div class="col-md-6">
      <div class="form-group">
        <label for="id_photo" class="form-label">
          ID/Passport Photo <span class="text-danger">*</span>
          <small class="text-muted d-block">(Max. 2MB, JPG/PNG)</small>
        </label>
        <input type="file" class="form-control" id="id_photo" name="id_photo" required 
               accept="image/jpeg, image/png">
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-group">
        <label for="qualifications" class="form-label">
          Qualifications/Certificates
          <small class="text-muted d-block">(PDF, Max. 5MB each)</small>
        </label>
        <input type="file" class="form-control" id="qualifications" 
               name="qualifications" multiple accept=".pdf">
      </div>
    </div>
    
    <!-- Terms and Conditions -->
    <div class="col-12">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="terms" required>
        <label class="form-check-label small" for="terms">
          I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and 
          <a href="#" class="text-decoration-none">Privacy Policy</a>
        </label>
        <div class="invalid-feedback">
          You must agree before submitting.
        </div>
      </div>
    </div>
    
    <!-- Submit Button -->
    <div class="col-12 mt-4">
      <button type="submit" class="btn btn-primary btn-lg w-100">
        <i class="fas fa-user-plus me-2"></i> Complete Registration
      </button>
    </div>
  </div>
</form>
{% endblock %}

{% block form_footer %}
<div class="text-center mt-4">
  <p class="mb-0">
    Already have an account? 
    <a href="{% url 'schoolmanagement:login' %}" class="fw-semibold text-decoration-none">
      Sign in here
    </a>
  </p>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Form validation
(function () {
  'use strict'
  
  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  const forms = document.querySelectorAll('.needs-validation')
  
  // Loop over them and prevent submission
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      
      form.classList.add('was-validated')
    }, false)
  })
})()

// Password strength indicator
const password1 = document.getElementById('password1');
const password2 = document.getElementById('password2');

if (password1) {
  password1.addEventListener('input', function() {
    const strengthBadge = document.getElementById('password-strength') || 
      (() => {
        const badge = document.createElement('div');
        badge.id = 'password-strength';
        badge.className = 'form-text';
        password1.parentNode.appendChild(badge);
        return badge;
      })();
    
    const strength = checkPasswordStrength(this.value);
    strengthBadge.textContent = `Strength: ${strength.text}`;
    strengthBadge.className = `form-text text-${strength.color} fw-medium`;
  });
}

if (password1 && password2) {
  password2.addEventListener('input', function() {
    if (this.value !== password1.value) {
      this.setCustomValidity('Passwords do not match');
    } else {
      this.setCustomValidity('');
    }
  });
}

function checkPasswordStrength(password) {
  // Check password strength
  let strength = 0;
  
  // Contains at least one number
  if (/\d/.test(password)) strength++;
  
  // Contains at least one special character
  if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;
  
  // Contains at least one uppercase letter
  if (/[A-Z]/.test(password)) strength++;
  
  // Contains at least one lowercase letter
  if (/[a-z]/.test(password)) strength++;
  
  // At least 8 characters long
  if (password.length >= 8) strength++;
  
  // Return strength level
  if (strength <= 2) {
    return { text: 'Weak', color: 'danger' };
  } else if (strength <= 4) {
    return { text: 'Moderate', color: 'warning' };
  } else {
    return { text: 'Strong', color: 'success' };
  }
}
</script>
{% endblock %}
